<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Windows API - Let’s Play with the Windows Environment Variables!" /><meta name="author" content="Mr. Rc" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this blog, we are going to have a look at two functions that let us manipulate the Environment Variables of our Windows Machine. There are only two functions that are related to Environment Variables in Windows API, but I found them useful and fascinating. The functions that we are going to use in this blog are GetEnvironmentVariable and SetEnvironmentVariable." /><meta property="og:description" content="In this blog, we are going to have a look at two functions that let us manipulate the Environment Variables of our Windows Machine. There are only two functions that are related to Environment Variables in Windows API, but I found them useful and fascinating. The functions that we are going to use in this blog are GetEnvironmentVariable and SetEnvironmentVariable." /><link rel="canonical" href="/posts/WinAPI-Environment-Variables/" /><meta property="og:url" content="/posts/WinAPI-Environment-Variables/" /><meta property="og:site_name" content="Mr. Rc’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-18T09:03:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Windows API - Let’s Play with the Windows Environment Variables!" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Mr. Rc"},"headline":"Windows API - Let’s Play with the Windows Environment Variables!","dateModified":"2021-07-27T13:27:59+05:30","datePublished":"2021-06-18T09:03:00+05:30","description":"In this blog, we are going to have a look at two functions that let us manipulate the Environment Variables of our Windows Machine. There are only two functions that are related to Environment Variables in Windows API, but I found them useful and fascinating. The functions that we are going to use in this blog are GetEnvironmentVariable and SetEnvironmentVariable.","url":"/posts/WinAPI-Environment-Variables/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/WinAPI-Environment-Variables/"},"@context":"https://schema.org"}</script><title>Windows API - Let's Play with the Windows Environment Variables! | Mr. Rc's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mr. Rc's blog"><meta name="application-name" content="Mr. Rc's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script data-ad-client="ca-pub-2858626085073914" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-199874344-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-199874344-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://i.ibb.co/6W31BDG/skull.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mr. Rc's blog</a></div><div class="site-subtitle font-italic">A collection of Mr. Rc's Blogs.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/HACKE-RC" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cr.retsim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Windows API - Let's Play with the Windows Environment Variables!</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Windows API - Let's Play with the Windows Environment Variables!</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mr. Rc </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 18, 2021, 9:03 AM +0530" prep="on" > Jun 18, 2021 <i class="unloaded">2021-06-18T09:03:00+05:30</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 27, 2021, 1:27 PM +0530" prefix="Updated " > Jul 27, 2021 <i class="unloaded">2021-07-27T13:27:59+05:30</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2171 words">12 min</span></div></div><div class="post-content"><p>In this blog, we are going to have a look at two functions that let us manipulate the Environment Variables of our Windows Machine. There are only two functions that are related to Environment Variables in Windows API, but I found them useful and fascinating. The functions that we are going to use in this blog are <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> and <code class="language-plaintext highlighter-rouge">SetEnvironmentVariable</code>.</p><p>Before diving in, let’s try to understand what are environment variables and how they are stored in Windows.</p><h1 id="what-is-an-environment-variable">What is An Environment Variable?</h1><p>In the simplest terms, in a Windows Machine, an Environment Variable is a dynamic object or changeable data that any process on your machine could use and manipulate (if they have necessary privileges).</p><p>If you know Python, you can understand them like a dictionary, in which every key has a value assigned to it. This is not how they actually look, but you can use this to understand Environment Variables:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">environment_var</span> <span class="o">=</span> <span class="p">{</span><span class="s">"var"</span><span class="p">:</span> <span class="s">"value"</span><span class="p">}</span>
</pre></table></code></div></div><p>There are two types of Environment Variables:</p><ol><li>User Environment Variables.<li>System Environment Variables.</ol><h2 id="user-environment-variables-and-system-environment-variables">User Environment Variables and System Environment Variables</h2><p>As you might already know, you can have different users on same Windows machine. So, the User Environment Variables are specific to a single user for which they were made, and System Environment Variables are same for every user on the same System / Machine.</p><p>The user Environment Variables are stored in the Windows Registry at the path <code class="language-plaintext highlighter-rouge">HKEY_CURRENT_USER\Environment</code> and the location of System Environment Variables in the Windows registry is <code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment</code>.</p><p>You can look them up, user environment variables should look like this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.ibb.co/XxPXVXm/image.png" alt="https://i.ibb.co/XxPXVXm/image.png" /></p><h2 id="some-more-insights-on-environment-variables">Some more insights on Environment Variables</h2><p>By default, a child process receives its Environment Variables from its parent process. The maximum size of a user-defined environment variable is 32,767 characters. <br /> <code class="language-plaintext highlighter-rouge">SetEnvironmentVariable</code> function can’t actually change an Environment Variable globally, the function only changes the Environment Variable for the process that called the function and the child processes that it will create. If you actually want to change any Environment Variable for the user/system programmatically, you need to change the registry key from the specific path, rather than just changing the Environment Variables. I will explain this more later in this blog.</p><h1 id="1-getenvironmentvariable">1. GetEnvironmentVariable</h1><p>As the name suggests, this function is used to get the contents of an Environment Variable.</p><p>The Function Signature looks like this:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">DWORD</span> <span class="nf">GetEnvironmentVariable</span><span class="p">(</span>
  <span class="n">LPCTSTR</span> <span class="n">lpName</span><span class="p">,</span>
  <span class="n">LPTSTR</span>  <span class="n">lpBuffer</span><span class="p">,</span>
  <span class="n">DWORD</span>   <span class="n">nSize</span>
<span class="p">);</span>
</pre></table></code></div></div><p>Don’t get scared by the <code class="language-plaintext highlighter-rouge">DWORD</code> return type, it’s defined as <code class="language-plaintext highlighter-rouge">typedef unsigned __LONG32 DWORD;</code> in the <code class="language-plaintext highlighter-rouge">winmindef.h</code>, which means it’ll just return an integer.</p><p>The first parameter of this function is <code class="language-plaintext highlighter-rouge">lpName</code>. The type of this parameter is <code class="language-plaintext highlighter-rouge">LPCSTR</code>.</p><p>This parameter is used to specify the name of the Environment Variable whose value we want to use in our Program.</p><p>The second parameter is <code class="language-plaintext highlighter-rouge">lpBuffer</code>, if you read my blogs, you might already know that the parameters with these names are used to specify the pointer to the buffer that receives the output from the function. In this particular function, the output will be a null terminated string that will contain the value of the Environment Variable that we specified as the first argument.</p><p>The last parameter is <code class="language-plaintext highlighter-rouge">nSize</code>, it is used to specify the size of the <code class="language-plaintext highlighter-rouge">lpBuffer</code> argument along with the space for null terminator. If this feels complex to you, let me explain you more easily. Imagine the following c code in a function:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</pre></table></code></div></div><p>Here, we have made a variable called <code class="language-plaintext highlighter-rouge">data</code> and we are assuming that this variable will store the value of the Environment Variable as a string.</p><p>The size of this variable is 10, which includes the size of the null character that will be stored at the end, so technically, the size of this variable is 9, you can only store 9 characters in this variable, and the 10th character will be a null terminator.</p><p>So, if we need to get the value of an Environment Variable, we need to make a char array of its size + 1.</p><h3 id="return-value">Return Value</h3><p>If this function succeeds, it returns the size of characters that it stored in the address of the argument that we supplied in the <code class="language-plaintext highlighter-rouge">lpBuffer</code> parameter (not including the size of the null terminator).</p><p>If <code class="language-plaintext highlighter-rouge">lpBuffer</code> is not large enough to hold the value of the requested Environment Variable, it will return the size required to store the value including the null terminator, and nothing will be done with the <code class="language-plaintext highlighter-rouge">lpBuffer</code> parameter.</p><h1 id="2-setenvironmentvariable">2. SetEnvironmentVariable</h1><p><code class="language-plaintext highlighter-rouge">SetEnvironmentVariable</code> function is used to set an Environment Variable. Calling this function will not change the value of this Variable for any other process, it will only last in the process that created it until the process is not killed. As we learned before, a child process inherits its Environment Variables from the parent process. So, if a process sets an Environment Variable and then creates a child process, then only the child process will have that Environment Variable set.</p><p>The Function Signature of this one looks like this:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">BOOL</span> <span class="nf">SetEnvironmentVariable</span><span class="p">(</span>
  <span class="n">LPCTSTR</span> <span class="n">lpName</span><span class="p">,</span>
  <span class="n">LPCTSTR</span> <span class="n">lpValue</span>
<span class="p">);</span>
</pre></table></code></div></div><p>The return type of the function is the same as the last one, So it will just return a number.</p><p>The first parameter is <code class="language-plaintext highlighter-rouge">lpName</code>, which, of course, takes the name of the Environment Variable that you want to create/change.</p><p>The second parameter is <code class="language-plaintext highlighter-rouge">lpValue</code>, which will be the value for the Environment Variable in the first parameter.</p><h2 id="what-are-we-supposed-to-do-about-this-function">What are we supposed to do about this function?</h2><p>As I told you, we can’t change an Environment Variable globally using <code class="language-plaintext highlighter-rouge">SetEnvironmnetVariable</code> function. Then, how are we supposed to change an environment variable programmatically?</p><p>I told you that we can manipulate the registry keys from the specific paths of each Environment Variable and it will change the Environment Variables globally (for the user or the whole system).</p><p>In the next part of this blog, we will be writing a wrapper that will do that for us. I could have included it in this part, but it will make the blog post long and boring.</p><p>In this blog, we are just going to see the use of the function <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> and see how can we use it, It will also be fun ;)</p><p>I could also have included the usage of the<code class="language-plaintext highlighter-rouge">SetEnvironmentVariable</code> function by showing you a program that changes its Environment Variable using the <code class="language-plaintext highlighter-rouge">SetEnvironmentVariable</code> function, but to demonstrate that this function actually works, I would have needed to make a child process of the program itself. We haven’t explored the functions that allow us to do so. I promise to write blog posts on those functions too!</p><h1 id="code-example---1">Code Example - 1</h1><p>Now, let’s make a function that uses the function <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> and does something.</p><p>Here is the code of the function that I made:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
</span>
<span class="c1">// this program will get the value of the environment variable "COMPUTERNAME" (which contains the name of your Windows computer) and print it</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">com_name</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// this variable will store the value returned from the Environment Variable</span>
    
    <span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s">"COMPUTERNAME"</span><span class="p">,</span> <span class="n">com_name</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="c1">// calling the GetEnvironmentvVariable to get the value of COMPUTERNAME environment variable</span>
    <span class="n">puts</span><span class="p">(</span><span class="n">com_name</span><span class="p">);</span> <span class="c1">// printing the environment variable</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Quite simple, right?</p><p>The comments of the code pretty much explain what’s going on, but I’m still going to explain what this code is doing.</p><p>First, We declare the Variable <code class="language-plaintext highlighter-rouge">com_name</code>, which we will use to store the value of the Environment Variable, the size of this variable is 200 and it can store 199 characters and a null terminator.</p><p>Next, we call the function <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> to get the value of the Environment Variable which is <code class="language-plaintext highlighter-rouge">COMPUTERNAME</code> and store it in <code class="language-plaintext highlighter-rouge">com_name</code> variable. And, as you have learnt, we have to specify the size of the variable in the third argument, which is <code class="language-plaintext highlighter-rouge">nSize</code>, We also do that by specifying 200.</p><p>Then we simply call the <code class="language-plaintext highlighter-rouge">puts</code> function to print the Environment Variable.</p><p>The output of the code is pretty simple and, as expected, it just prints the value of the Environment Variable which we stored in the <code class="language-plaintext highlighter-rouge">com_name</code> variable and nothing else, which looks like this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.ibb.co/5MVZZcV/image.png" alt="https://i.ibb.co/5MVZZcV/image.png" /></p><p>Awesome!!</p><p>But, this one was too small, lets look at a bigger one and make something more cool.</p><h1 id="code-example---2">Code Example - 2</h1><p>Now, we are going to add some more functionality to our little program. This time, we will ask the user to enter the name of the Environment Variable and we will also add error throw error if the Environment Variable that the user is requesting doesn’t exits.</p><p>The code that I made to achieve this is here:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">env_name</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// to store the name of the Environment Variable.</span>
    <span class="kt">char</span> <span class="n">env_value</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// to store the value of the Environment Variable.</span>

    <span class="n">puts</span><span class="p">(</span><span class="s">"Enter the name of the variable whose value you want to know: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">env_name</span><span class="p">);</span>

    <span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="n">env_name</span><span class="p">,</span> <span class="n">env_value</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="c1">// calling the GetEnvironmentVariable function to get the value of the Environment variable.</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">GetLastError</span><span class="p">()</span><span class="o">==</span><span class="n">ERROR_ENVVAR_NOT_FOUND</span><span class="p">)</span> <span class="c1">// Error checking.</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"ERROR: Environment Variable %s does not exits."</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR CODE: %d"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">GetLastError</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"The value of the Environment variable %s is %s.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">env_name</span><span class="p">,</span> <span class="n">env_value</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This Program is also simple as it looks, let me explain…</p><p>First we declare two variables, <code class="language-plaintext highlighter-rouge">env_name</code> and <code class="language-plaintext highlighter-rouge">env_value</code> of both 200 size.</p><p>Then we ask the user to input the name of the Variable whose value they want to know, and we store the input in the <code class="language-plaintext highlighter-rouge">env_name</code> variable.</p><p>Then we call our almighty function, <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> with <code class="language-plaintext highlighter-rouge">env_name</code> variable as the first parameter, which stores the name of the Environment Variable whose value the user wants to know.</p><p>We pass the <code class="language-plaintext highlighter-rouge">env_value</code> variable as the second parameter, which is the variable that will store the value of the Environment Variable (if the function succeeds). And, we specify the last and third parameter as the size of the second parameter.</p><p>After all this, comes the interesting part. If you read my blogs frequently (which you should), you probably already know the usage of the <code class="language-plaintext highlighter-rouge">GetLastError</code>.</p><p>If you don’t know read my blogs frequently, let me explain you the function <code class="language-plaintext highlighter-rouge">GetLastError</code>, it’s used to get the last error, but what “last”?</p><p>“Last” is referring to the last function that you called, So, In this program, I have called the <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> function. So, this function will return the error code of the error that occurred in the <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> function and we can lookup this error codes here: <a href="https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-">System Error Codes (0-499) (WinError.h) - Win32 apps</a></p><p>But, if you look at the code, I have compared the return value of <code class="language-plaintext highlighter-rouge">GetLastError</code> with the constant <code class="language-plaintext highlighter-rouge">ERROR_ENVVAR_NOT_FOUND</code> which is defined in <code class="language-plaintext highlighter-rouge">winerror.h</code> which is actually <code class="language-plaintext highlighter-rouge">203</code> in decimal.</p><p>The reason why I am comparing this with <code class="language-plaintext highlighter-rouge">ERROR_ENVVAR_NOT_FOUND</code> constant or the value <code class="language-plaintext highlighter-rouge">203</code> is because it’s the return value that <code class="language-plaintext highlighter-rouge">GetLastError</code> function will return when we try to access an Environment Variable that doesn’t exits.</p><p>So, How do I know that I need to use this constant and not any other?</p><p>Well, the answer to this question is simply because I have experimented this and if you ask me how I did that, This is the code that I used:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">env_value</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">error_code</span><span class="p">;</span>

    <span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s">"aenvvarthatnoappwillmakeibet"</span><span class="p">,</span> <span class="n">env_value</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="c1">// calling the GetEnvironmentVariable function and requesting the value of a non-existing Environment Variable.</span>
    <span class="n">error_code</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"The Error code is: %d"</span><span class="p">,</span> <span class="n">error_code</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>If you have understood the blog until this line, you probably have understood that this code is trying to request a value of a non-existing environment variable then it’s calling the <code class="language-plaintext highlighter-rouge">GetLastError</code> function to get the error code of the last error that the last function call had and then printing it.</p><p>The output of this code looks like this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.ibb.co/Sx7Rznr/image.png" alt="https://i.ibb.co/Sx7Rznr/image.png" /></p><p>Okay, now you know what error code the <code class="language-plaintext highlighter-rouge">GetEnvironmentVariable</code> returns when the Environment Variable does not exits, Now, How can I know which constant to compare it to?</p><p>Well, to know that, I’ll refer you to this page again: <a href="https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-">System Error Codes (0-499) (WinError.h) - Win32 apps</a></p><p>You can search the error code there and find which constant you should use, in this case, It was this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.ibb.co/kxpQ5K1/image.png" alt="https://i.ibb.co/kxpQ5K1/image.png" /></p><p>You can use pretty much the same approach to find error codes for any other error.</p><p>Let’s get back to the program that I made, After I compared the error code with the constant, I displayed the error message exited with the return code of the error, which will be 203 in this case. This was the whole explaination of this program, I hope you found it interesting!</p><p>And that was all for this one, I hope you learnt something new, I will be back with the second part of this blog very soon :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>Programming</a>, <a href='/categories/windows/'>Windows</a>, <a href='/categories/windows-internals/'>Windows Internals</a>, <a href='/categories/winapi/'>WinAPI</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/windows-api-series/" class="post-tag no-text-decoration" >Windows API Series</a> <a href="/tags/virtual-memory-management/" class="post-tag no-text-decoration" >Virtual Memory Management</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Windows API - Let's Play with the Windows Environment Variables! - Mr. Rc's blog&url=/posts/WinAPI-Environment-Variables/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Windows API - Let's Play with the Windows Environment Variables! - Mr. Rc's blog&u=/posts/WinAPI-Environment-Variables/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Windows API - Let's Play with the Windows Environment Variables! - Mr. Rc's blog&url=/posts/WinAPI-Environment-Variables/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/WinAPI-Using-Registry-Playing-With-Env-Variables/">Windows API - Let's use the register to change our Environment!</a><li><a href="/posts/WinAPI-Environment-Variables/">Windows API - Let's Play with the Windows Environment Variables!</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/windows-api-series/">Windows API Series</a> <a class="post-tag" href="/tags/virtual-memory-management/">Virtual Memory Management</a> <a class="post-tag" href="/tags/heap-api/">Heap API</a> <a class="post-tag" href="/tags/assembly/">Assembly</a> <a class="post-tag" href="/tags/operating-system/">Operating system</a> <a class="post-tag" href="/tags/windows-registry/">Windows Registry</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Windows-API-Basics-of-Virtual-Memory-Management-API/"><div class="card-body"> <span class="timeago small" > Apr 15, 2021 <i class="unloaded">2021-04-15T09:03:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Windows API - Basics of Virtual Memory Management API.</h3><div class="text-muted small"><p> The Virtual Memory Manager in Windows (WMM) is available for user mode programs and can be used by the Win32 APIs to allocate memory and free them in the user space. From this blog, I am going to ...</p></div></div></a></div><div class="card"> <a href="/posts/Windows-API-More-on-Virtual-Memory/"><div class="card-body"> <span class="timeago small" > Apr 18, 2021 <i class="unloaded">2021-04-18T09:03:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Windows API - More on Virtual Memory.</h3><div class="text-muted small"><p> In this blog, we are going to have a look at some basic memory related things that we can do with the API functions that we learnt about in last blog post along with a new function VirtualQuery. B...</p></div></div></a></div><div class="card"> <a href="/posts/Windows-API-Heap-Functions/"><div class="card-body"> <span class="timeago small" > Apr 26, 2021 <i class="unloaded">2021-04-26T09:03:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Windows API - Let's learn about heap in deep!</h3><div class="text-muted small"><p> In this blog, We are continuing our series and going to study some Windows API functions related to Heap. We’ll see how to use this functions and how they can be useful to us with code examples and...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Heap-Chapter-End/" class="btn btn-outline-primary" prompt="Older"><p>Windows API - Let's end the Heap Chapter!</p></a> <a href="/posts/WinAPI-Using-Registry-Playing-With-Env-Variables/" class="btn btn-outline-primary" prompt="Newer"><p>Windows API - Let's use the register to change our Environment!</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/coder_rc">Mr. Rc</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/windows-api-series/">Windows API Series</a> <a class="post-tag" href="/tags/virtual-memory-management/">Virtual Memory Management</a> <a class="post-tag" href="/tags/heap-api/">Heap API</a> <a class="post-tag" href="/tags/assembly/">Assembly</a> <a class="post-tag" href="/tags/operating-system/">Operating system</a> <a class="post-tag" href="/tags/windows-registry/">Windows Registry</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
